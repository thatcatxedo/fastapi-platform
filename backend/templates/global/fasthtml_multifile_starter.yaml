name: "FastHTML Multi-File Starter"
description: "An organized FastHTML app with HTMX interactions. Routes, services, and HTML components in separate files."
requires_database: true
complexity: medium
tags:
  - multifile
  - fasthtml
  - htmx
  - mongodb
  - organized
mode: multi
framework: fasthtml
entrypoint: app.py
files:
  app.py: |
    from fasthtml.common import *
    from routes import setup_routes

    app, rt = fast_app()
    setup_routes(rt)

    @rt("/health")
    def health():
        return {"status": "ok"}

  routes.py: |
    from fasthtml.common import *
    from services import get_items, create_item, delete_item
    from components import item_list, item_form, page_layout

    def setup_routes(rt):
        @rt("/")
        def home():
            items = get_items()
            return page_layout(
                H1("My Items"),
                item_form(),
                item_list(items)
            )

        @rt("/items", methods=["POST"])
        def add_item(name: str):
            create_item(name)
            items = get_items()
            return item_list(items)

        @rt("/items/{item_id}", methods=["DELETE"])
        def remove_item(item_id: str):
            delete_item(item_id)
            items = get_items()
            return item_list(items)

  models.py: |
    """Data models for the app."""
    from dataclasses import dataclass
    from typing import Optional

    @dataclass
    class Item:
        id: str
        name: str
        description: Optional[str] = None

  services.py: |
    from pymongo import MongoClient
    from bson import ObjectId
    import os

    db = MongoClient(os.environ["PLATFORM_MONGO_URI"]).get_default_database()

    def get_items():
        items = list(db.items.find())
        return [{"id": str(item["_id"]), "name": item["name"]} for item in items]

    def create_item(name: str):
        db.items.insert_one({"name": name})

    def delete_item(item_id: str):
        db.items.delete_one({"_id": ObjectId(item_id)})

  components.py: |
    from fasthtml.common import *

    def page_layout(*children):
        return Titled("FastHTML App", *children)

    def item_form():
        return Form(
            Input(name="name", placeholder="Item name", required=True),
            Button("Add Item"),
            hx_post="/items",
            hx_target="#item-list",
            hx_swap="outerHTML"
        )

    def item_list(items):
        return Ul(
            *[item_row(item) for item in items],
            id="item-list"
        )

    def item_row(item):
        return Li(
            Span(item["name"]),
            Button("x",
                hx_delete=f"/items/{item['id']}",
                hx_target="#item-list",
                hx_swap="outerHTML"
            )
        )
