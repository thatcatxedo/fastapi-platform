name: "Hello World Slack Bot"
description: "A simple Slack bot that responds to mentions using the Slack Events API. Learn how to build Slack integrations with webhooks and event handling."
complexity: simple
tags:
  - slack
  - bot
  - webhook
  - events-api
mode: single
code: |
  from fastapi import FastAPI, Request, HTTPException, Header
  from slack_sdk.signature import SignatureVerifier
  from slack_sdk.web import WebClient
  import os
  import json

  app = FastAPI()

  # Slack configuration - set these as environment variables in your app settings
  # Get these from https://api.slack.com/apps -> Your App -> Basic Information
  SLACK_SIGNING_SECRET = os.environ.get("SLACK_SIGNING_SECRET", "")
  SLACK_BOT_TOKEN = os.environ.get("SLACK_BOT_TOKEN", "")

  # Initialize Slack signature verifier and web client
  signature_verifier = SignatureVerifier(signing_secret=SLACK_SIGNING_SECRET)
  slack_client = WebClient(token=SLACK_BOT_TOKEN) if SLACK_BOT_TOKEN else None

  @app.get("/")
  async def root():
      return {
          "message": "Slack Bot is running!",
          "instructions": "Configure SLACK_SIGNING_SECRET and SLACK_BOT_TOKEN environment variables, then set your Slack app's Event Subscriptions URL to: https://your-app-url/slack/events"
      }

  @app.post("/slack/events")
  async def slack_events(request: Request, x_slack_signature: str = Header(None), x_slack_request_timestamp: str = Header(None)):
      """
      Handle Slack Events API webhook.

      Setup instructions:
      1. Create a Slack app at https://api.slack.com/apps
      2. Go to "Event Subscriptions" and enable it
      3. Set Request URL to: https://your-app-url/slack/events
      4. Subscribe to "app_mentions" event (bot_events)
      5. Install app to workspace and get Bot User OAuth Token
      6. Copy Signing Secret from Basic Information
      7. Add both as environment variables: SLACK_SIGNING_SECRET and SLACK_BOT_TOKEN
      """
      body = await request.body()

      # Verify request signature
      if not signature_verifier.is_valid(
          body=body,
          timestamp=x_slack_request_timestamp,
          signature=x_slack_signature
      ):
          raise HTTPException(status_code=403, detail="Invalid signature")

      data = await request.json()

      # Handle URL verification challenge (Slack sends this when you first add the URL)
      if data.get("type") == "url_verification":
          return {"challenge": data.get("challenge")}

      # Handle events
      if data.get("type") == "event_callback":
          event = data.get("event", {})
          event_type = event.get("type")

          # Respond to app_mention events (when someone mentions your bot)
          if event_type == "app_mention":
              channel = event.get("channel")
              text = event.get("text", "")
              user = event.get("user")

              # Simple response
              if slack_client:
                  try:
                      slack_client.chat_postMessage(
                          channel=channel,
                          text="Hello World! You mentioned me!"
                      )
                  except Exception as e:
                      print(f"Error posting message: {e}")

              return {"status": "ok"}

      return {"status": "ok"}

  @app.get("/health")
  async def health():
      return {"status": "healthy"}
